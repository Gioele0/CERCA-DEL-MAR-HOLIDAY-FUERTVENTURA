<script>
  // === TRADUZIONI MULTILINGUA ===
  const translations = {
    it: {
      navDiscover: "Scopri",
      navHomes: "Case vacanze",
      navHelp: "Aiuto",
      ownersArea: "Area proprietari",
      heroTitle: "Case vacanze selezionate a Fuerteventura.",
      heroSubtitle:
        "Prenota appartamenti, ville e case vacanze in tutta Fuerteventura, con assistenza locale e pagamenti sicuri.",
      badgeSecurePayments: "‚úÖ Pagamenti sicuri",
      badgeVerifiedGuests: "‚≠ê Ospiti verificati",
      badgeFlexibleCancel: "üïí Cancellazione flessibile",
      labelWhere: "Dove",
      labelCheckin: "Check-in",
      labelCheckout: "Check-out",
      btnSearch: "Cerca",
      heroFooter:
        "Pi√π di <strong>5.000 ospiti</strong> hanno prenotato con noi nell'ultimo anno.",
      tagRealtimeBooking: "Prenotazione in tempo reale",
      heroPreviewMeta: "4 ospiti ¬∑ 2 camere",
      filtersTitle: "Filtri rapidi",
      filterMaxPrice: "Prezzo massimo (‚Ç¨/notte)",
      filterGuests: "Ospiti",
      filterType: "Tipo di alloggio",
      guestsAny: "Qualsiasi",
      guests2: "Fino a 2 ospiti",
      guests4: "Fino a 4 ospiti",
      guests6: "Fino a 6 ospiti",
      guests7: "Pi√π di 6 ospiti",
      typeAll: "Tutti",
      typeApartment: "Appartamento",
      typeVilla: "Villa",
      typeHouse: "Casa indipendente",
      btnApplyFilters: "Applica",
      btnResetFilters: "Azzera",
      filtersHint:
        "Suggerimento: usa il campo ‚ÄúDove‚Äù per cercare una zona specifica di Fuerteventura.",
      resultsTitle: "Case vacanze a Fuerteventura",
      sortRecommended: "Consigliati",
      sortPriceAsc: "Prezzo crescente",
      sortPriceDesc: "Prezzo decrescente",
      resultsCountSingular: "1 alloggio trovato",
      resultsCountPlural: "{count} alloggi trovati",
      badgeInstantBooking: "Prenotazione immediata",
      badgeTopChoice: "Top scelta",
      badgeNew: "Nuova",
      perNight: "/ notte",
      cardCta: "Vedi dettagli & prenota ‚Üí",
      helpTitle: "Hai bisogno di aiuto per trovare la casa giusta?",
      helpText:
        "Scrivici i tuoi bisogni (zona dell‚Äôisola, budget, numero di persone) e ti invieremo una selezione di alloggi ideali per te.",
      modalDescription:
        "Descrizione sintetica dell'alloggio. Qui potrai inserire i dettagli principali, le regole della casa, le dotazioni e tutte le informazioni utili per gli ospiti.",
      formName: "Nome",
      formEmail: "Email",
      formMessage: "Messaggio",
      btnSendRequest: "Invia richiesta di prenotazione",
      modalNote:
        "Non viene effettuato nessun pagamento ora. Riceverai conferma e dettagli via email.",
      btnClose: "Chiudi",
      placeholderLocation: "Fuerteventura, Corralejo, El Cotillo‚Ä¶",
      placeholderName: "Il tuo nome",
      placeholderEmail: "nome@email.com",
      placeholderMessage: "Richiesta o domanda"
    },
    es: {
      navDiscover: "Descubre",
      navHomes: "Alojamientos",
      navHelp: "Ayuda",
      ownersArea: "Zona propietarios",
      heroTitle: "Alojamientos seleccionados en Fuerteventura.",
      heroSubtitle:
        "Reserva apartamentos, villas y casas vacacionales en toda Fuerteventura, con asistencia local y pagos seguros.",
      badgeSecurePayments: "‚úÖ Pagos seguros",
      badgeVerifiedGuests: "‚≠ê Hu√©spedes verificados",
      badgeFlexibleCancel: "üïí Cancelaci√≥n flexible",
      labelWhere: "D√≥nde",
      labelCheckin: "Check-in",
      labelCheckout: "Check-out",
      btnSearch: "Buscar",
      heroFooter:
        "M√°s de <strong>5.000 hu√©spedes</strong> han reservado con nosotros en el √∫ltimo a√±o.",
      tagRealtimeBooking: "Reserva en tiempo real",
      heroPreviewMeta: "4 hu√©spedes ¬∑ 2 dormitorios",
      filtersTitle: "Filtros r√°pidos",
      filterMaxPrice: "Precio m√°ximo (‚Ç¨/noche)",
      filterGuests: "Hu√©spedes",
      filterType: "Tipo de alojamiento",
      guestsAny: "Cualquiera",
      guests2: "Hasta 2 hu√©spedes",
      guests4: "Hasta 4 hu√©spedes",
      guests6: "Hasta 6 hu√©spedes",
      guests7: "M√°s de 6 hu√©spedes",
      typeAll: "Todos",
      typeApartment: "Apartamento",
      typeVilla: "Villa",
      typeHouse: "Casa",
      btnApplyFilters: "Aplicar",
      btnResetFilters: "Reiniciar",
      filtersHint:
        "Consejo: usa el campo ‚ÄúD√≥nde‚Äù para buscar una zona concreta de Fuerteventura.",
      resultsTitle: "Alojamientos en Fuerteventura",
      sortRecommended: "Recomendados",
      sortPriceAsc: "Precio ascendente",
      sortPriceDesc: "Precio descendente",
      resultsCountSingular: "1 alojamiento encontrado",
      resultsCountPlural: "{count} alojamientos encontrados",
      badgeInstantBooking: "Reserva inmediata",
      badgeTopChoice: "Opci√≥n destacada",
      badgeNew: "Nuevo",
      perNight: "/ noche",
      cardCta: "Ver detalles y reservar ‚Üí",
      helpTitle: "¬øNecesitas ayuda para encontrar el alojamiento ideal?",
      helpText:
        "Cu√©ntanos tus necesidades (zona de la isla, presupuesto, n√∫mero de personas) y te enviaremos una selecci√≥n hecha a medida.",
      modalDescription:
        "Descripci√≥n breve del alojamiento. Aqu√≠ puedes indicar los detalles principales, normas de la casa, equipamiento e informaci√≥n √∫til para los hu√©spedes.",
      formName: "Nombre",
      formEmail: "Correo electr√≥nico",
      formMessage: "Mensaje",
      btnSendRequest: "Enviar solicitud de reserva",
      modalNote:
        "No se realiza ning√∫n pago ahora. Recibir√°s la confirmaci√≥n y los detalles por correo electr√≥nico.",
      btnClose: "Cerrar",
      placeholderLocation: "Fuerteventura, Corralejo, El Cotillo‚Ä¶",
      placeholderName: "Tu nombre",
      placeholderEmail: "nombre@correo.com",
      placeholderMessage: "Solicitud o pregunta"
    },
    en: {
      navDiscover: "Explore",
      navHomes: "Holiday homes",
      navHelp: "Help",
      ownersArea: "Host area",
      heroTitle: "Handpicked holiday homes in Fuerteventura.",
      heroSubtitle:
        "Book apartments, villas and holiday homes across Fuerteventura with local support and secure payments.",
      badgeSecurePayments: "‚úÖ Secure payments",
      badgeVerifiedGuests: "‚≠ê Verified guests",
      badgeFlexibleCancel: "üïí Flexible cancellation",
      labelWhere: "Where",
      labelCheckin: "Check-in",
      labelCheckout: "Check-out",
      btnSearch: "Search",
      heroFooter:
        "More than <strong>5,000 guests</strong> booked with us last year.",
      tagRealtimeBooking: "Real-time booking",
      heroPreviewMeta: "4 guests ¬∑ 2 bedrooms",
      filtersTitle: "Quick filters",
      filterMaxPrice: "Max price (‚Ç¨/night)",
      filterGuests: "Guests",
      filterType: "Property type",
      guestsAny: "Any",
      guests2: "Up to 2 guests",
      guests4: "Up to 4 guests",
      guests6: "Up to 6 guests",
      guests7: "More than 6 guests",
      typeAll: "All",
      typeApartment: "Apartment",
      typeVilla: "Villa",
      typeHouse: "House",
      btnApplyFilters: "Apply",
      btnResetFilters: "Reset",
      filtersHint:
        "Tip: use the ‚ÄúWhere‚Äù field to search a specific area in Fuerteventura.",
      resultsTitle: "Holiday homes in Fuerteventura",
      sortRecommended: "Recommended",
      sortPriceAsc: "Price (low to high)",
      sortPriceDesc: "Price (high to low)",
      resultsCountSingular: "1 property found",
      resultsCountPlural: "{count} properties found",
      badgeInstantBooking: "Instant booking",
      badgeTopChoice: "Top pick",
      badgeNew: "New",
      perNight: "/ night",
      cardCta: "View details & book ‚Üí",
      helpTitle: "Need help finding the right place?",
      helpText:
        "Tell us what you need (area of the island, budget, number of guests) and we‚Äôll send you a tailored selection of homes.",
      modalDescription:
        "Short description of the property. Add main features, house rules, amenities and all useful information for your guests.",
      formName: "Name",
      formEmail: "Email",
      formMessage: "Message",
      btnSendRequest: "Send booking request",
      modalNote:
        "No payment is made now. You will receive confirmation and details by email.",
      btnClose: "Close",
      placeholderLocation: "Fuerteventura, Corralejo, El Cotillo‚Ä¶",
      placeholderName: "Your name",
      placeholderEmail: "name@email.com",
      placeholderMessage: "Request or question"
    },
    fr: {
      navDiscover: "D√©couvrir",
      navHomes: "Locations",
      navHelp: "Aide",
      ownersArea: "Espace propri√©taires",
      heroTitle: "Locations de vacances s√©lectionn√©es √† Fuerteventura.",
      heroSubtitle:
        "R√©servez appartements, villas et maisons de vacances sur toute Fuerteventura, avec assistance locale et paiements s√©curis√©s.",
      badgeSecurePayments: "‚úÖ Paiements s√©curis√©s",
      badgeVerifiedGuests: "‚≠ê Voyageurs v√©rifi√©s",
      badgeFlexibleCancel: "üïí Annulation flexible",
      labelWhere: "O√π",
      labelCheckin: "Arriv√©e",
      labelCheckout: "D√©part",
      btnSearch: "Rechercher",
      heroFooter:
        "Plus de <strong>5 000 voyageurs</strong> ont r√©serv√© avec nous l‚Äôan dernier.",
      tagRealtimeBooking: "R√©servation en temps r√©el",
      heroPreviewMeta: "4 voyageurs ¬∑ 2 chambres",
      filtersTitle: "Filtres rapides",
      filterMaxPrice: "Prix max (‚Ç¨/nuit)",
      filterGuests: "Voyageurs",
      filterType: "Type de logement",
      guestsAny: "Tous",
      guests2: "Jusqu‚Äô√† 2 voyageurs",
      guests4: "Jusqu‚Äô√† 4 voyageurs",
      guests6: "Jusqu‚Äô√† 6 voyageurs",
      guests7: "Plus de 6 voyageurs",
      typeAll: "Tous",
      typeApartment: "Appartement",
      typeVilla: "Villa",
      typeHouse: "Maison",
      btnApplyFilters: "Appliquer",
      btnResetFilters: "R√©initialiser",
      filtersHint:
        "Astuce : utilisez le champ ¬´ O√π ¬ª pour rechercher une zone pr√©cise de Fuerteventura.",
      resultsTitle: "Locations √† Fuerteventura",
      sortRecommended: "Recommand√©s",
      sortPriceAsc: "Prix croissant",
      sortPriceDesc: "Prix d√©croissant",
      resultsCountSingular: "1 logement trouv√©",
      resultsCountPlural: "{count} logements trouv√©s",
      badgeInstantBooking: "R√©servation imm√©diate",
      badgeTopChoice: "Choix pr√©f√©r√©",
      badgeNew: "Nouveau",
      perNight: "/ nuit",
      cardCta: "Voir le d√©tail & r√©server ‚Üí",
      helpTitle: "Besoin d‚Äôaide pour trouver le bon logement ?",
      helpText:
        "Indiquez-nous vos crit√®res (zone de l‚Äô√Æle, budget, nombre de personnes) et nous vous enverrons une s√©lection sur mesure.",
      modalDescription:
        "Description courte du logement. Ajoutez les principaux √©quipements, r√®gles de la maison et informations utiles pour vos voyageurs.",
      formName: "Nom",
      formEmail: "E-mail",
      formMessage: "Message",
      btnSendRequest: "Envoyer la demande de r√©servation",
      modalNote:
        "Aucun paiement n‚Äôest effectu√© maintenant. Vous recevrez la confirmation et les d√©tails par e-mail.",
      btnClose: "Fermer",
      placeholderLocation: "Fuerteventura, Corralejo, El Cotillo‚Ä¶",
      placeholderName: "Votre nom",
      placeholderEmail: "nom@email.com",
      placeholderMessage: "Demande ou question"
    },
    de: {
      navDiscover: "Entdecken",
      navHomes: "Ferienh√§user",
      navHelp: "Hilfe",
      ownersArea: "Bereich f√ºr Vermieter",
      heroTitle: "Ausgew√§hlte Ferienunterk√ºnfte auf Fuerteventura.",
      heroSubtitle:
        "Buche Apartments, Villen und Ferienh√§user auf ganz Fuerteventura ‚Äì mit lokalem Support und sicheren Zahlungen.",
      badgeSecurePayments: "‚úÖ Sichere Zahlungen",
      badgeVerifiedGuests: "‚≠ê Verifizierte G√§ste",
      badgeFlexibleCancel: "üïí Flexible Stornierung",
      labelWhere: "Wo",
      labelCheckin: "Anreise",
      labelCheckout: "Abreise",
      btnSearch: "Suchen",
      heroFooter:
        "√úber <strong>5.000 G√§ste</strong> haben im letzten Jahr bei uns gebucht.",
      tagRealtimeBooking: "Echtzeit-Buchung",
      heroPreviewMeta: "4 G√§ste ¬∑ 2 Schlafzimmer",
      filtersTitle: "Schnellfilter",
      filterMaxPrice: "Max. Preis (‚Ç¨/Nacht)",
      filterGuests: "G√§ste",
      filterType: "Unterkunftsart",
      guestsAny: "Alle",
      guests2: "Bis zu 2 G√§ste",
      guests4: "Bis zu 4 G√§ste",
      guests6: "Bis zu 6 G√§ste",
      guests7: "Mehr als 6 G√§ste",
      typeAll: "Alle",
      typeApartment: "Apartment",
      typeVilla: "Villa",
      typeHouse: "Haus",
      btnApplyFilters: "Anwenden",
      btnResetFilters: "Zur√ºcksetzen",
      filtersHint:
        "Tipp: Nutze das Feld ‚ÄûWo‚Äú, um nach einer bestimmten Region auf Fuerteventura zu suchen.",
      resultsTitle: "Ferienunterk√ºnfte auf Fuerteventura",
      sortRecommended: "Empfohlen",
      sortPriceAsc: "Preis aufsteigend",
      sortPriceDesc: "Preis absteigend",
      resultsCountSingular: "1 Unterkunft gefunden",
      resultsCountPlural: "{count} Unterk√ºnfte gefunden",
      badgeInstantBooking: "Sofortbuchung",
      badgeTopChoice: "Top Auswahl",
      badgeNew: "Neu",
      perNight: "/ Nacht",
      cardCta: "Details ansehen & buchen ‚Üí",
      helpTitle: "Brauchst du Hilfe bei der Suche?",
      helpText:
        "Schreibe uns deine W√ºnsche (Region der Insel, Budget, Personenzahl) und wir senden dir eine passende Auswahl.",
      modalDescription:
        "Kurze Beschreibung der Unterkunft. F√ºge Hauptmerkmale, Hausregeln, Ausstattung und alle wichtigen Infos f√ºr deine G√§ste hinzu.",
      formName: "Name",
      formEmail: "E-Mail",
      formMessage: "Nachricht",
      btnSendRequest: "Buchungsanfrage senden",
      modalNote:
        "Es wird jetzt keine Zahlung f√§llig. Du erh√§ltst Best√§tigung und Details per E-Mail.",
      btnClose: "Schlie√üen",
      placeholderLocation: "Fuerteventura, Corralejo, El Cotillo‚Ä¶",
      placeholderName: "Dein Name",
      placeholderEmail: "name@email.com",
      placeholderMessage: "Anfrage oder Frage"
    }
  };

  const langDefault = "it";

  // Applica una lingua all'interfaccia
  function applyLanguage(lang) {
    const dict = translations[lang] || translations[langDefault];

    // elementi con data-i18n -> textContent o innerHTML
    document.querySelectorAll("[data-i18n]").forEach((el) => {
      const key = el.getAttribute("data-i18n");
      const value = dict[key];
      if (!value) return;
      if (value.includes("<strong>")) {
        el.innerHTML = value;
      } else {
        el.textContent = value;
      }
    });

    // badge nelle card (evita errori su childNodes)
    document.querySelectorAll("[data-i18n-badge]").forEach((el) => {
      const key = el.getAttribute("data-i18n-badge");
      const value = dict[key];
      if (!value) return;
      // prendo l'ultimo nodo di testo dopo il pallino
      const textNode = Array.from(el.childNodes).find(
        (n) => n.nodeType === Node.TEXT_NODE
      );
      if (textNode) {
        textNode.nodeValue = " " + value;
      }
    });

    // placeholder campi
    const locationInput = document.getElementById("search-location");
    if (locationInput && dict.placeholderLocation) {
      locationInput.placeholder = dict.placeholderLocation;
    }
    const nameInput = document.getElementById("modal-name");
    if (nameInput && dict.placeholderName) {
      nameInput.placeholder = dict.placeholderName;
    }
    const emailInput = document.getElementById("modal-email");
    if (emailInput && dict.placeholderEmail) {
      emailInput.placeholder = dict.placeholderEmail;
    }
    const msgInput = document.getElementById("modal-message");
    if (msgInput && dict.placeholderMessage) {
      msgInput.placeholder = dict.placeholderMessage;
    }

    // aggiorna label "/ notte" ecc.
    document.querySelectorAll("[data-i18n='perNight']").forEach((el) => {
      if (dict.perNight) el.textContent = dict.perNight;
    });

    // aggiorna conteggio risultati
    updateResultsCount(currentVisibleCount());
  }

  function currentVisibleCount() {
    const cards = Array.from(
      document.querySelectorAll("#properties-grid .property-card")
    );
    return cards.filter((c) => c.style.display !== "none").length;
  }

  function updateResultsCount(count) {
    const lang = document.getElementById("lang-switcher").value || langDefault;
    const dict = translations[lang] || translations[langDefault];
    const el = document.getElementById("results-count");
    if (!el) return;
    if (count === 1) {
      el.textContent = dict.resultsCountSingular;
    } else {
      el.textContent = (dict.resultsCountPlural || "").replace(
        "{count}",
        String(count)
      );
    }
  }

  // === FILTRI & ORDINAMENTO ===
  const propertiesGrid = document.getElementById("properties-grid");
  const cards = Array.from(propertiesGrid.querySelectorAll(".property-card"));

  const searchLocationInput = document.getElementById("search-location");
  const filterMaxPriceInput = document.getElementById("filter-max-price");
  const filterGuestsSelect = document.getElementById("filter-guests");
  const filterTypeSelect = document.getElementById("filter-type");
  const btnApplyFilters = document.getElementById("btn-apply-filters");
  const btnResetFilters = document.getElementById("btn-reset-filters");
  const btnSearch = document.getElementById("btn-search");
  const sortSelect = document.getElementById("sort-select");

  function applyFilters() {
    const searchLocation = searchLocationInput.value.trim().toLowerCase();
    const maxPrice = parseFloat(filterMaxPriceInput.value);
    const guestsValue = filterGuestsSelect.value;
    const typeValue = filterTypeSelect.value;

    let visibleCount = 0;

    cards.forEach((card) => {
      const location = card.dataset.location.toLowerCase();
      const price = parseFloat(card.dataset.price);
      const guests = parseInt(card.dataset.guests, 10);
      const type = card.dataset.type;

      let show = true;

      if (searchLocation && !location.includes(searchLocation)) {
        show = false;
      }

      if (!Number.isNaN(maxPrice) && price > maxPrice) {
        show = false;
      }

      if (guestsValue) {
        const g = parseInt(guestsValue, 10);
        if (g === 7) {
          if (guests <= 6) show = false;
        } else {
          if (guests > g) show = false;
        }
      }

      if (typeValue && type !== typeValue) {
        show = false;
      }

      card.style.display = show ? "" : "none";
      if (show) visibleCount += 1;
    });

    updateResultsCount(visibleCount);
    sortCards(); // mantieni ordine con sort attivo
  }

  function resetFilters() {
    searchLocationInput.value = "";
    filterMaxPriceInput.value = "";
    filterGuestsSelect.value = "";
    filterTypeSelect.value = "";
    sortSelect.value = "recommended";
    cards.forEach((card) => (card.style.display = ""));
    cards.forEach((card) => propertiesGrid.appendChild(card));
    updateResultsCount(cards.length);
  }

  function sortCards() {
    const value = sortSelect.value;
    const visibleCards = cards.filter(
      (card) => card.style.display !== "none"
    );

    if (value === "recommended") {
      cards.forEach((card) => propertiesGrid.appendChild(card));
      return;
    }

    visibleCards.sort((a, b) => {
      const priceA = parseFloat(a.dataset.price);
      const priceB = parseFloat(b.dataset.price);
      if (value === "price-asc") return priceA - priceB;
      return priceB - priceA;
    });

    visibleCards.forEach((card) => propertiesGrid.appendChild(card));
  }

  btnApplyFilters.addEventListener("click", applyFilters);
  btnSearch.addEventListener("click", applyFilters);
  btnResetFilters.addEventListener("click", resetFilters);
  sortSelect.addEventListener("change", sortCards);

  // === MODALE DETTAGLI ===
  const modalBackdrop = document.getElementById("modal-backdrop");
  const modalTitle = document.getElementById("modal-title");
  const modalImage = document.getElementById("modal-image");
  const modalMeta = document.getElementById("modal-meta");
  const modalPrice = document.getElementById("modal-price");
  const modalClose = document.getElementById("modal-close");
  const modalCancel = document.getElementById("modal-cancel");

  function openModalFromCard(card) {
    const title = card.querySelector(".property-title").textContent;
    const location = card
      .querySelector(".property-location")
      .textContent.trim();
    const meta = card.querySelector(".property-meta").textContent.trim();
    const price = card.dataset.price;
    const imgSrc = card.querySelector("img").src;

    modalTitle.textContent = title;
    modalImage.src = imgSrc;
    modalMeta.textContent = location + " ¬∑ " + meta;

    const lang = document.getElementById("lang-switcher").value || langDefault;
    const dict = translations[lang] || translations[langDefault];
    modalPrice.textContent = "‚Ç¨" + price + " " + (dict.perNight || "/ notte");

    modalBackdrop.style.display = "flex";
    modalBackdrop.setAttribute("aria-hidden", "false");
  }

  cards.forEach((card) => {
    card.addEventListener("click", () => openModalFromCard(card));
  });

  function closeModal() {
    modalBackdrop.style.display = "none";
    modalBackdrop.setAttribute("aria-hidden", "true");
  }

  modalClose.addEventListener("click", closeModal);
  modalCancel.addEventListener("click", closeModal);
  modalBackdrop.addEventListener("click", (event) => {
    if (event.target === modalBackdrop) closeModal();
  });

  // blocca invio finto (per ora solo front-end)
  document.getElementById("modal-send").addEventListener("click", (e) => {
    e.preventDefault();
    alert("Questa √® una demo: qui potrai collegare il tuo sistema di prenotazione o email.");
  });

  // === CAMBIO LINGUA ===
  const langSwitcher = document.getElementById("lang-switcher");
  langSwitcher.addEventListener("change", (e) => {
    applyLanguage(e.target.value);
  });

  // Inizializzazione
  document.addEventListener("DOMContentLoaded", () => {
    applyLanguage(langDefault);
    updateResultsCount(cards.length);
  });
</script>
